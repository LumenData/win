<script>
	var dataframe_nrow = {{ dataframe_nrow }}
</script>

<script>
	// May need a $(document).ready() wrapper	

	var column_name = $(".popover_wrapper").data("parent_id");
	var remote_url = '/data/frame/' + dataframe_id + '/' + column_name + '/unique_values.json';
	
	// Initialize training/test slider
	$('#training-precent').slider({
		min: 0,
		max: 100,
		step: 1,
		value: 75,
		handle: 'round',
	});

	// Training/test slider action (update the numbers below the slider)
	$('#training-precent').on('slide', function(ev){
		$("#training-percent").html($(this).val());
		$("#test-percent").html(100 - $(this).val());
		
		var training_rows = Math.floor(dataframe_nrow * $(this).val() / 100);
		var test_rows = dataframe_nrow - training_rows;
		$("#training-rows").html(training_rows);
		$("#test-rows").html(test_rows);
	});

	$('#training-precent').trigger('slide');

	// Apply Button
	$("#apply_predictions").on("click",function(event){
		var prediction_form = $(this).closest(".popover_wrapper");
		var column_name = prediction_form.data("parent_id");
		var prediction_item = $("#report-predictions").find("#" + column_name)
		
		console.debug("prediction_form", prediction_form)
		console.debug("column_name", column_name)
		console.debug("prediction_item", prediction_item)
		

		// Get the slider value and set it as an attribute on the DOM (so that it can get picked up by the update_chart function)
		var training_percent = $('#training-precent').val();
		var training_nrow = Math.floor(training_percent * dataframe_nrow / 100);
		prediction_item.attr("data-training_nrow", training_nrow);
		
		// Close the popup
		prediction_item.popover('hide');
		
		// Refresh the predictions
		update_predictions();
	});
	
	// Cancel Button
	$("#cancel_predictions").on("click",function(event){
		$("#report-predictions").find("div").popover('hide');
	});

</script>

<style>
	.slider_info{
		display: inline;
		float: left;
	}
	
	.slider_info.left{
		float: left;
	}
	
	.slider_info.right{
		float: right;
	}
</style>


<b>Data Split</b><br>
<span class="slider_info">
	Test<br>
</span>

<span class="slider_info right">
	Training<br>
</span>
<p>

<input id="training-precent" type="text" class="span2" value=75></input><br>
<span class="slider_info">
	<span id="test-percent">25</span>%<br>
	<span id="test-rows"></span> rows
</span>

<span class="slider_info right">
	<span id="training-percent">75</span>%<br> 
	<span id="training-rows"></span> rows
</span>

<br><br><br><p>

<div style:"display: block; height: 100px">
	<button id="apply_predictions" class="btn btn-sm btn-primary">Predict</button>
	<button id="cancel_predictions" class="btn btn-sm btn-default">Cancel</button>
</div>